<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Values Survey — Present & 2075</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
<style>
  :root {
    --primary: #007bff;
    --success: #28a745;
    --bg: #f3f5f9;
    --text: #333;
    --muted: #555;
    --card: #fff;
  }
  * { box-sizing: border-box; }
  body {
    font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    background: var(--bg);
    color: var(--text);
    margin: 0;
    padding: 0 16px 24px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  h1 {
    text-align: center;
    margin: 30px 0 10px;
    font-size: 1.9rem;
    color: #222;
  }
  p.lead {
    text-align: center;
    max-width: 820px;
    color: var(--muted);
    line-height: 1.5;
    font-size: 1rem;
    margin: 0 0 1.6rem;
  }
  .plots {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 2rem;
    width: 100%;
    max-width: 1200px;
  }
  .plot-card {
    background: var(--card);
    border-radius: 16px;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
    padding: 1.25rem 1.25rem 1rem;
    width: 500px;
    max-width: 100%;
    text-align: center;
  }
  .plot-card h2 {
    color: var(--primary);
    font-size: 1.25rem;
    margin: 0 0 0.25rem;
  }
  .plot-card h2.future { color: var(--success); }
  .plot {
    width: 100%;
    height: 480px; /* important: gives Plotly space to render */
  }
  .values {
    font-weight: 500;
    margin-top: 0.5rem;
    font-size: 1.05rem;
  }
  .hint {
    font-size: 0.9rem;
    color: var(--muted);
    margin-top: 0.25rem;
  }
  form {
    margin: 1.5rem 0 0.5rem;
    text-align: center;
  }
  button {
    background-color: var(--primary);
    border: none;
    color: white;
    padding: 0.8rem 1.4rem;
    border-radius: 10px;
    font-size: 1rem;
    cursor: pointer;
    transition: background 0.2s ease, transform 0.05s ease-in-out;
  }
  button:hover { background-color: #0056b3; }
  button:active { transform: translateY(1px); }
  footer {
    margin: 24px 0 18px;
    font-size: 0.9rem;
    color: #666;
    text-align: center;
  }
  .error {
    background: #ffe9e9;
    color: #a40000;
    border: 1px solid #f1b4b4;
    padding: 10px 12px;
    border-radius: 8px;
    margin: 10px 0 0;
    display: none;
    max-width: 900px;
  }
</style>
</head>
<body>

<h1>Values Survey — Present Day vs Year 2075</h1>
<p class="lead">
  Click inside each triangle to set your balance across the three priorities below.
  The closer you click to a corner, the more you value that dimension. Then press “Submit”.
</p>

<div id="loadError" class="error" role="alert"></div>

<div class="plots">
  <div class="plot-card">
    <h2>Present Day</h2>
    <div id="plot-present" class="plot" role="img" aria-label="Ternary plot for Present Day"></div>
    <div class="values" id="valuesPresent">Click inside the triangle to select your point.</div>
    <div class="hint">Economic Growth • Health & Wellbeing • Care for Climate</div>
  </div>

  <div class="plot-card">
    <h2 class="future">Year 2075</h2>
    <div id="plot-future" class="plot" role="img" aria-label="Ternary plot for Year 2075"></div>
    <div class="values" id="valuesFuture">Click inside the triangle to select your point.</div>
    <div class="hint">Economic Growth • Health & Wellbeing • Care for Climate</div>
  </div>
</div>

<form id="surveyForm" action="https://formspree.io/f/YOUR_FORM_ID" method="POST" novalidate>
  <!-- Present -->
  <input type="hidden" name="economic_present" id="econPresent">
  <input type="hidden" name="health_present" id="healthPresent">
  <input type="hidden" name="climate_present" id="climatePresent">

  <!-- Future -->
  <input type="hidden" name="economic_future" id="econFuture">
  <input type="hidden" name="health_future" id="healthFuture">
  <input type="hidden" name="climate_future" id="climateFuture">

  <button type="submit">Submit Both Responses</button>
</form>

<footer>© 2025 Digital Society Project — Interactive Values Survey</footer>

<script>
  // Load Plotly with fallbacks, then initialize plots.
  (async function boot() {
    const errorBox = document.getElementById("loadError");
    const cdns = [
      "https://cdn.plot.ly/plotly-2.27.1.min.js",
      "https://cdn.plot.ly/plotly-latest.min.js",
      "https://unpkg.com/plotly.js-dist-min@2.27.1/plotly.min.js"
    ];

    async function loadScript(src) {
      return new Promise((resolve, reject) => {
        const s = document.createElement("script");
        s.src = src;
        s.async = true;
        s.onload = () => resolve(src);
        s.onerror = () => reject(new Error("Failed to load " + src));
        document.head.appendChild(s);
      });
    }

    let loaded = false;
    for (const src of cdns) {
      try {
        await loadScript(src);
        if (window.Plotly) {
          loaded = true;
          break;
        }
      } catch (e) {
        // try the next CDN
      }
    }

    if (!loaded) {
      errorBox.style.display = "block";
      errorBox.textContent = "Could not load Plotly. Check your network/CSP and try again.";
      return;
    }

    console.log("Plotly version:", Plotly.version);
    initPlots();
  })();

  function generateTernaryGrid(sum = 100, step = 2) {
    const a = [], b = [], c = [];
    for (let A = 0; A <= sum; A += step) {
      for (let B = 0; B <= sum - A; B += step) {
        const C = sum - A - B;
        a.push(A);
        b.push(B);
        c.push(C);
      }
    }
    return { a, b, c };
  }

  function createTernaryPlot({ plotId, displayId, econInputId, healthInputId, climateInputId, color }) {
    const el = document.getElementById(plotId);
    const displayEl = document.getElementById(displayId);
    const SUM = 100;
    const STEP = 2; // denser grid for reliable clicks

    const grid = generateTernaryGrid(SUM, STEP);

    const gridTrace = {
      type: "scatterternary",
      mode: "markers",
      name: "Click area",
      a: grid.a,
      b: grid.b,
      c: grid.c,
      marker: {
        size: 22,
        // tiny visible alpha ensures pickability in all browsers
        color: "rgba(0,0,0,0.01)",
        line: { width: 0 },
        opacity: 0.01
      },
      hoverinfo: "skip",
      showlegend: false
    };

    const selectedTrace = {
      type: "scatterternary",
      mode: "markers",
      name: "Your selection",
      a: [34],
      b: [33],
      c: [33],
      marker: { color, size: 12, symbol: "circle" },
      hovertemplate:
        "Economic Growth: %{a}%<br>" +
        "Health & Wellbeing: %{b}%<br>" +
        "Care for Climate: %{c}%<extra></extra>",
      showlegend: false
    };

    const layout = {
      ternary: {
        sum: SUM,
        aaxis: { title: "Economic Growth", min: 0 },
        baxis: { title: "Health & Wellbeing", min: 0 },
        caxis: { title: "Care for Climate", min: 0 },
        bgcolor: "#fff"
      },
      margin: { t: 36, l: 40, r: 40, b: 40 },
      paper_bgcolor: "#fff",
      plot_bgcolor: "#fff",
      showlegend: false,
      hovermode: "closest"
    };

    const config = { responsive: true, displayModeBar: false };

    Plotly.newPlot(el, [gridTrace, selectedTrace], layout, config);

    function updateSelection(A, B, C) {
      Plotly.restyle(el, { a: [[A]], b: [[B]], c: [[C]] }, [1]);
      const aPct = Number(A).toFixed(0);
      const bPct = Number(B).toFixed(0);
      const cPct = Number(C).toFixed(0);
      displayEl.innerHTML = `<strong>Selected Values:</strong><br>
        Economic Growth: ${aPct}% &nbsp; | &nbsp;
        Health & Wellbeing: ${bPct}% &nbsp; | &nbsp;
        Care for Climate: ${cPct}%`;
      document.getElementById(econInputId).value = aPct;
      document.getElementById(healthInputId).value = bPct;
      document.getElementById(climateInputId).value = cPct;
      el.dataset.clicked = "true";
    }

    // Initialize with a balanced default to confirm rendering
    updateSelection(34, 33, 33);

    el.on("plotly_click", (evt) => {
      const gridPoint = evt.points && evt.points.find(p => p.curveNumber === 0);
      if (!gridPoint) return;
      updateSelection(gridPoint.a, gridPoint.b, gridPoint.c);
    });

    // Keep responsive
    window.addEventListener("resize", () => {
      Plotly.Plots.resize(el);
    });
  }

  function initPlots() {
    createTernaryPlot({
      plotId: "plot-present",
      displayId: "valuesPresent",
      econInputId: "econPresent",
      healthInputId: "healthPresent",
      climateInputId: "climatePresent",
      color: "#007bff"
    });
    createTernaryPlot({
      plotId: "plot-future",
      displayId: "valuesFuture",
      econInputId: "econFuture",
      healthInputId: "healthFuture",
      climateInputId: "climateFuture",
      color: "#28a745"
    });

    // Prevent submit without both clicks
    document.getElementById("surveyForm").addEventListener("submit", function (e) {
      const presentClicked = document.getElementById("plot-present").dataset.clicked === "true";
      const futureClicked = document.getElementById("plot-future").dataset.clicked === "true";
      if (!presentClicked || !futureClicked) {
        e.preventDefault();
        alert("Please click on both triangles to select your values before submitting.");
      }
    });
  }
</script>
</body>
</html>
